<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>z - Advanced topic: Handling packages with remote dependencies</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">z - Advanced topic: Handling packages with
remote dependencies</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Packages published on CRAN must have their dependencies on either
CRAN or Bioconductor, but not on GitHub. However, there are many
packages available on GitHub that never get published on CRAN, and some
of these packages may even depend on other packages that are also only
available on GitHub. <code>{rix}</code> makes it possible to install
packages from GitHub, but in case one of the package’s dependencies has
also only been released on GitHub, building the Nix environment will
fail. This is because Nix will be looking for these packages on
<code>nixpkgs</code>, but only packages released on CRAN and
Bioconductor are available through <code>nixpkgs</code>. This vignette
explains how to install such a packages that have dependencies only
available on GitHub.</p>
</div>
<div id="the-lookup-package" class="section level2">
<h2>The {lookup} package</h2>
<p>As an example we are going to use the <a href="https://github.com/jimhester/lookup">{lookup}</a> package which
has only been released on GitHub. <a href="https://github.com/jimhester/lookup">Here is the repository</a>.
This package comes with the <code>lookup()</code> function which makes
it possible to check the source code of any function from a loaded
package, even if the source of that function is in C or Fortran. To
create a reproducible development environment that makes <a href="https://github.com/jimhester/lookup">{lookup}</a> available to
you, you could use the following <code>rix::rix()</code> call:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>path_default_nix <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">rix</span>(</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">r_ver =</span> <span class="st">&quot;latest&quot;</span>,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">r_pkgs =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">system_pkgs =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">git_pkgs =</span> <span class="fu">list</span>(</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    <span class="at">package_name =</span> <span class="st">&quot;lookup&quot;</span>,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    <span class="at">repo_url =</span> <span class="st">&quot;https://github.com/jimhester/lookup/&quot;</span>,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    <span class="at">commit =</span> <span class="st">&quot;eba63db477dd2f20153b75e2949eb333a36cccfc&quot;</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  ),</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="at">ide =</span> <span class="st">&quot;other&quot;</span>,</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="at">project_path =</span> path_default_nix,</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>  <span class="at">print =</span> <span class="cn">TRUE</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>)</span></code></pre></div>
<p>Trying to build this environment will fail with following error
message:</p>
<pre><code>error: attribute &#39;highlite&#39; missing</code></pre>
</div>
<div id="building-remote-dependencies" class="section level2">
<h2>Building remote dependencies</h2>
<p><code>{highlite}</code> is a dependency of <a href="https://github.com/jimhester/lookup">{lookup}</a> that is only
available on GitHub. This can be checked by looking at the
<code>DESCRIPTION</code> file of <a href="https://github.com/jimhester/lookup">{lookup}</a>:</p>
<pre><code>Remotes:
    jimhester/highlite,
    gaborcsardi/gh,
    hadley/memoise</code></pre>
<p>We see that there are actually three packages that come from GitHub:
but <code>{gh}</code> and <code>{memoise}</code> have in the meantime
been released on CRAN, which means that they are also available through
<code>nixpkgs</code>. We have to deal with <code>{highlite}</code>
however, because it never got released on CRAN. Doing so is fairly easy:
first, create a new expression using <code>{rix}</code> to install
<code>{highlite}</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>path_default_nix <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">rix</span>(</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="at">r_ver =</span> <span class="st">&quot;latest&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="at">r_pkgs =</span> <span class="cn">NULL</span>,</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>  <span class="at">system_pkgs =</span> <span class="cn">NULL</span>,</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>  <span class="at">git_pkgs =</span> <span class="fu">list</span>(</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>    <span class="at">package_name =</span> <span class="st">&quot;highlite&quot;</span>,</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>    <span class="at">repo_url =</span> <span class="st">&quot;https://github.com/jimhester/highlite/&quot;</span>,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>    <span class="at">commit =</span> <span class="st">&quot;767b122ef47a60a01e1707e4093cf3635a99c86b&quot;</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>  ),</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>  <span class="at">ide =</span> <span class="st">&quot;other&quot;</span>,</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>  <span class="at">project_path =</span> path_default_nix,</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>  <span class="at">print =</span> <span class="cn">TRUE</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>)</span></code></pre></div>
<p>(you don’t need to overwrite the previous expression, simply printing
this one on screen will do). Copy the following lines:</p>
<pre><code>git_archive_pkgs = [(pkgs.rPackages.buildRPackage {
  name = &quot;highlite&quot;;
  src = pkgs.fetchgit {
    url = &quot;https://github.com/jimhester/highlite/&quot;;
    rev = &quot;767b122ef47a60a01e1707e4093cf3635a99c86b&quot;;
    sha256 = &quot;sha256-lkWMlAi75MYxiBUYnLwxLK9ApXkWanA4Mt7g4qtLpxM=&quot;;
  };
  propagatedBuildInputs = builtins.attrValues {
    inherit (pkgs.rPackages) Rcpp BH;
  };
}) ];</code></pre>
<p>into the previous expression (and change
<code>git_archive_pkgs</code> into <code>highlite</code>). The file
should look like this now:</p>
<pre><code>let
 pkgs = import (fetchTarball &quot;https://github.com/NixOS/nixpkgs/archive/b200e0df08f80c32974a6108ce431d8a8a5e6547.tar.gz&quot;) {};

  highlite = [(pkgs.rPackages.buildRPackage {
    name = &quot;highlite&quot;;
    src = pkgs.fetchgit {
      url = &quot;https://github.com/jimhester/highlite/&quot;;
      rev = &quot;767b122ef47a60a01e1707e4093cf3635a99c86b&quot;;
      sha256 = &quot;sha256-lkWMlAi75MYxiBUYnLwxLK9ApXkWanA4Mt7g4qtLpxM=&quot;;
    };
    propagatedBuildInputs = builtins.attrValues {
      inherit (pkgs.rPackages) Rcpp BH;
    };
  }) ];
  git_archive_pkgs = [(pkgs.rPackages.buildRPackage {
    name = &quot;lookup&quot;;
    src = pkgs.fetchgit {
      url = &quot;https://github.com/jimhester/lookup/&quot;;
      rev = &quot;eba63db477dd2f20153b75e2949eb333a36cccfc&quot;;
      sha256 = &quot;sha256-arl7LVxL8xGUW3LhuDCSUjcfswX0rdofL/7v8Klw8FM=&quot;;
    };
    propagatedBuildInputs = builtins.attrValues {
      inherit (pkgs.rPackages) gh memoise Rcpp codetools crayon rex highlite jsonlite rstudioapi withr httr;
    };
  }) ];
 system_packages = builtins.attrValues {
  inherit (pkgs) R ;
};
  in
  pkgs.mkShell {
    buildInputs = [ git_archive_pkgs  system_packages  ];
      shellHook = &#39;&#39;
R --vanilla
&#39;&#39;;
  }
</code></pre>
<p>The only thing that we need to change is this line:</p>
<pre><code>propagatedBuildInputs = builtins.attrValues {
      inherit (pkgs.rPackages) gh memoise Rcpp codetools crayon rex highlite jsonlite rstudioapi withr httr;
    };</code></pre>
<p>into:</p>
<pre><code>propagatedBuildInputs = builtins.attrValues {
      inherit (pkgs.rPackages) gh memoise Rcpp codetools crayon rex jsonlite rstudioapi withr httr;
    } ++ [highlite];
</code></pre>
<p>Building the expression now succeeds.</p>
<p>We know that this is quite tedious, but at the moment there are no
plans to make <code>{rix}</code> handle remote dependencies
automatically. This is for mainly three reasons:</p>
<ul>
<li>packages with remote dependencies are rare, and never on CRAN on
Bioconductor;</li>
<li>packages may have remote dependencies, but these dependencies may
later be available on CRAN (such as with <code>{memoise}</code> and
<code>{gh}</code> for <a href="https://github.com/jimhester/lookup">{lookup}</a>);</li>
<li><code>{rix}</code> cannot decide for the user which commit to use
for a remote dependency (or whether to use the released version of that
dependency from CRAN).</li>
</ul>
<p>Because of these reasons, we believe that it is safer for users that
really need to use such packages to manually edit their Nix expressions.
Don’t hesitate to <a href="https://github.com/ropensci/rix/issues">open
an issue</a> if you require assistance.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
