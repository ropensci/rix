<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>e - Interactive use</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">e - Interactive use</h1>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This vignette describes interactive use of environments built with
<code>{rix}</code> using a GUI editor like RStudio. We will discuss
three scenarios: one in which you already have R and RStudio installed
on your operating system using the usual installation method for your
operating system, another in which you used Nix to install R and
RStudio, and finally the last scenario assumes you use another IDE than
RStudio, for example VS Code, Emacs, Vim…</p>
<p>It is also possible to evaluate single functions inside a dedicated,
separate, environment from another, main, interactive R session. For
more details regarding this, refer to the vignette
<code>vignette(&quot;z-advanced-topic-running-r-or-shell-code-in-nix-from-r&quot;)</code>.</p>
</div>
<div id="scenario-1-you-installed-r-and-rstudio-using-the-usual-installers" class="section level2">
<h2>Scenario 1: you installed R and RStudio using the usual
installers</h2>
<p>Let’s suppose that you are already running R and RStudio and that you
wish to start using <code>{rix}</code> to define reproducible
environments for your new projects starting today. These environments
will get built using the Nix package manager and will not only include
the required R packages for your project but also a specific version of
R, and any required system-level dependency as well. If you are used to
using RStudio, then you also need to install RStudio using Nix in these
project-specific environments. This is because RStudio re-defines many
environment variables and as such, a version of RStudio installed using
the usual installer for your operating system will not be able “to see”
an R interpreter installed with Nix. As stated in the macOS-specific
vignette <code>vignette(&quot;b2-setting-up-and-using-rix-on-macos&quot;)</code>,
RStudio is not available on macOS through <code>nixpkgs</code>. The
following instructions are thus only applicable to Linux and Windows. If
you’re on macOS, read the macOS-specific vignette if that’s not done
already, and then come back here and skip to the “scenario 3” of this
vignette.</p>
<p>To run a project-specific version of RStudio and R, you will first
need to create a <code>default.nix</code> file and build the environment
defined therein using Nix. Once this is done, you then need to activate
the environment before running this project-specific version of RStudio.
Suppose for example that you generated a <code>default.nix</code> file
for a project called “kmeans”, and suppose that this project is in the
following path: <code>~/Documents/kmeans</code> (on Windows it would be
something like <code>C:\Users\Billy\Documents\kmeans</code>). For
example, here is how you could use <code>{rix}</code> to generate the
<code>default.nix</code> for this environment:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(rix)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>path_to_project <span class="ot">&lt;-</span> <span class="st">&quot;~/Documents/kmeans&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">rix</span>(</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">r_ver =</span> <span class="st">&quot;latest&quot;</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">r_pkgs =</span> <span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>),</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="at">system_pkgs =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="at">git_pkgs =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  <span class="at">ide =</span> <span class="st">&quot;rstudio&quot;</span>,</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="at">project_path =</span> path_to_project,</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  <span class="at">print =</span> <span class="cn">TRUE</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>)</span></code></pre></div>
<p>Because you also have R installed through the usual method for your
operating system, you also have a system or user library of packages.
This library of packages will interfere with the library of packages of
your R environments managed by Nix. To avoid this, running
<code>rix()</code> not only writes a <code>default.nix</code> file in
your project’s path, but also a custom <code>.Rprofile</code> file as
well by calling <code>rix_init()</code>. This <code>.Rprofile</code>
will prevent clashes between your user library of packages and the Nix
environments’ library of packages.</p>
<p>Navigate to that folder using your terminal, and then run
<code>nix-build</code> to build the environment, and then
<code>nix-shell</code>. You will then be <em>dropped into</em> a Nix
shell. You can also use <code>nix-shell --pure</code> instead, if you
want to increase the isolation of your Nix-R environments. The
difference is that in an environment started with
<code>nix-shell</code>, you will still be able to access programs from
your system, while with <code>nix-shell --pure</code>, only programs
installed for that Nix-R environment will be available. Try something
like <code>which wget</code> from a shell started with
<code>nix-shell</code> and then from a shell started with
<code>nix-shell --pure</code> as an example (replace <code>wget</code>
by any other tool you have installed on your computer).</p>
<p>Once in the shell, you can type <code>rstudio</code> to run this
project specific version of R and RStudio with all the required packages
for this project, in this case <code>{dplyr}</code> and
<code>{ggplot2}</code>. If you get an error</p>
<pre><code>qt.glx: qglx_findConfig: Failed to finding...
qt.glx: qglx_findConfig: Failed to finding...
Could not initialize GLX
Aborted (core dumped)</code></pre>
<p>then you might need to run this before typing
<code>rstudio</code>:</p>
<pre><code>export QT_XCB_GL_INTEGRATION=none</code></pre>
<p>This should solve the issue. In any case, we would be thankful if you
opened an issue if you encountered this bug and if the fix worked for
you.</p>
<p>You can then work on it as usual.</p>
<p>You can also define a shortcut to a project that will take care of
activating the environment and launching RStudio. This way, you don’t
need to start a terminal in that folder and drop into the Nix
environment each time you want to work on this project. For example, you
could define a bash alias like this:</p>
<pre><code>alias kmeans=&#39;nix-shell ~/Documents/kmeans/default.nix --run rstudio</code></pre>
<p>which would then execute RStudio in the right project by simply
typing <code>kmeans</code> in a terminal. It’s also possible to create
an executable script that you can save in your PATH:</p>
<pre><code>#!/usr/bin/env nix-shell
#!nix-shell /home/Billy/Document/kmeans/default.nix -i bash
rstudio</code></pre>
<p>(if needed, add the <code>export QT_XCB_GL_INTEGRATION=none</code>
line before <code>rstudio</code>). Name this script something like
<code>kmeans_project</code>, make it executable (using
<code>chmod +x kmeans_project</code>), and now you can run RStudio
within this environment from anywhere.</p>
</div>
<div id="scenario-2-you-dont-have-any-regular-r-and-rstudio-installation-yet" class="section level2">
<h2>Scenario 2: you don’t have any regular R and RStudio installation
yet</h2>
<p>If you don’t have R installed you cannot use the <code>{rix}</code>
package to generate new expressions. In this case you might consider
installing Nix first, and then run the following command inside your
terminal to get dropped into a temporary Nix shell, which you can then
use to generate new <code>default.nix</code> files:</p>
<pre><code>nix-shell --expr &quot;$(curl -sl https://raw.githubusercontent.com/ropensci/rix/main/inst/extdata/default.nix)&quot;</code></pre>
<p>Running the command above will download R and <code>{rix}</code> and
then start an R session inside your terminal. You can now run something
like this:</p>
<pre><code>rix(r_ver = &quot;latest&quot;,
    r_pkgs = c(&quot;dplyr&quot;, &quot;ggplot2&quot;),
    system_pkgs = NULL,
    git_pkgs = NULL,
    ide = &quot;rstudio&quot;,
    # change to a project&#39;s path or leave it if you&#39;re in the right folder already
    project_path = &quot;.&quot;, 
    overwrite = TRUE)</code></pre>
<p>to generate a <code>default.nix</code>, and then use that file to
generate an environment with R, Rstudio, <code>{dplyr}</code> and
<code>{ggplot2}</code>. If you need to add packages for your project,
rerun the command above, but add the needed packages to
<code>r_pkgs</code>. If you need to create a new environment, you could
rerun the command above, or you could install <code>{rix}</code> in that
environment to generate new <code>default.nix</code> files. Here, there
is no need to use <code>rix_init()</code> as there won’t be any clash
between your user library of R packages (since you don’t have any), and
the R environments managed by Nix.</p>
</div>
<div id="scenario-3-you-use-some-ide-other-than-rstudio" class="section level2">
<h2>Scenario 3: you use some IDE other than RStudio</h2>
<p>VS Code and Emacs have been tested and unlike RStudio, you can use a
version of VS Code or Emacs installed through the usual means on your
system with development environments built with Nix. But there’s nothing
stopping you from installing a project-specific version of VS Code or
Emacs as well if you wish. Configuration and settings should be
accessible across every version from every environment, since these are
globally defined at the level of your system. This means that to work on
a project using VS Code, you would use a call to <code>rix()</code> like
so:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">rix</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">r_ver =</span> <span class="st">&quot;latest&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">r_pkgs =</span> <span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>),</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">system_pkgs =</span> <span class="cn">NULL</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="at">git_pkgs =</span> <span class="cn">NULL</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="at">ide =</span> <span class="st">&quot;code&quot;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="at">project_path =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>)</span></code></pre></div>
<p>Notice the <code>ide = &quot;code&quot;</code> argument. This will not install
VS Code from Nix, but will install the <code>{languageserver}</code>
package that is needed for using R with VS Code. If you want to also
install a project-specific version of VS Code, then use
<code>system_pkgs = &quot;vscode&quot;</code> or
<code>system_pkgs = &quot;vscodium&quot;</code> if you prefer VS Codium over VS
Code. For any other editor such as Emacs or Vim, set
<code>ide = &quot;other&quot;</code>. Also use <code>ide = &quot;other&quot;</code> if you
want to run scripts non-interactively, for example on a CI/CD
service.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>You now know the basics of Nix and <code>{rix}</code> and can start
using it for your projects! There are still some more vignettes that we
recommend you read which cover advanced topics.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
