% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/flake.R
\name{flake}
\alias{flake}
\title{Initialize a Nix Flake for the project}
\usage{
flake(
  r_ver = NULL,
  date = NULL,
  r_pkgs = NULL,
  system_pkgs = NULL,
  git_pkgs = NULL,
  local_r_pkgs = NULL,
  tex_pkgs = NULL,
  py_conf = NULL,
  jl_conf = NULL,
  ide = "none",
  template = "minimal",
  project_path = ".",
  overwrite = FALSE,
  git_tracking = TRUE,
  message_type = "simple",
  shell_hook = NULL,
  ignore_remotes_cache = FALSE
)
}
\arguments{
\item{r_ver}{Character. The required R version, for example "4.0.0". You can
check which R versions are available using \code{available_r()}, and for more
details check \code{available_df()}. For reproducibility purposes, you can also
provide a \code{nixpkgs} revision directly. For older versions of R, \code{nix-build}
might fail with an error stating 'this derivation is not meant to be
built'. In this case, simply drop into the shell with \code{nix-shell} instead
of building it first. It is also possible to provide either "bleeding-edge"
or "frozen-edge" if you need an environment with bleeding edge packages.
Read more in the "Details" section below.}

\item{date}{Character. Instead of providing \code{r_ver}, it is also possible to
provide a date. This will build an environment containing R and R packages
(and other dependencies) as of that date. You can check which dates are
available with \code{available_dates()}. For more details about versions check
\code{available_df()}.}

\item{r_pkgs}{Vector of characters. List the required R packages for your
analysis here.}

\item{system_pkgs}{Vector of characters. List further software you wish to
install that are not R packages such as command line applications for
example. You can look for available software on the NixOS website
\url{https://search.nixos.org/packages?channel=unstable&from=0&size=50&sort=relevance&type=packages&query=}}

\item{git_pkgs}{List. A list of packages to install from Git. See details for
more information.}

\item{local_r_pkgs}{Vector of characters, paths to local packages to install.
These packages need to be in the \code{.tar.gz} or \code{.zip} formats and must be in
the same folder as the generated "default.nix" file.}

\item{tex_pkgs}{Vector of characters. A set of TeX packages to install. Use
this if you need to compile \code{.tex} documents, or build PDF documents using
Quarto. If you don't know which package to add, start by adding "amsmath".
See the
\code{vignette("d2- installing-system-tools-and-texlive-packages-in-a-nix-environment")}
for more details.}

\item{py_conf}{List. A list containing two or three elements: \code{py_version},
\code{py_pkgs}, and optionally \code{py_src_dir}. \code{py_version} should be in the form
\code{"3.12"} for Python 3.12, and \code{py_pkgs} should be an atomic vector of
package names (e.g., \code{py_pkgs = c("polars", "plotnine", "great-tables")}).
If Python packages are requested but \code{{reticulate}} is not in the list of R
packages, the user will be warned that they may want to add it. When
\code{py_conf} packages are requested, the \code{RETICULATE_PYTHON} environment
variable is set to ensure the Nix environment does not use a system-wide
Python installation. If you are developing a Python package, set
\code{"mypackage/src"} or just \code{"src"}). This adds \code{PYTHONPATH} to the shell
hook so your package can be imported without installation. This is the Nix
equivalent of \verb{pip install -e .} (editable install). Note: if \code{"uv"} is in
\code{system_pkgs}, \code{LD_LIBRARY_PATH} is automatically configured for dynamic
library loading (required by packages like numpy). You can also install packages
from git or PyPI by adding \code{git_pkgs} (list of lists with \code{package_name}, \code{repo_url}, \code{commit})
and \code{pypi_pkgs} (vector of package names, optionally with version \code{name@version}) to
the \code{py_conf} list.}

\item{jl_conf}{List. A list of two elements, \code{jl_version} and \code{jl_conf}.
\code{jl_version} must be of the form \code{"1.10"} for Julia 1.10. Leave empty or
use an empty string to use the latest version, or use \code{"lts"} for the long
term support version. \code{jl_conf} must be an atomic vector of packages names,
for example \code{jl_conf = c("TidierData", "TidierPlots")}.}

\item{ide}{Character, defaults to "none". If you wish to use RStudio to work
interactively use "rstudio" or "rserver" for the server version. Use "code"
for Visual Studio Code or "codium" for Codium, or "positron" for Positron.
You can also use "radian", an interactive REPL. This will install a
project-specific version of the chosen editor which will be differrent than
the one already present in your system (if any). For other editors or if
you want to use an editor already installed on your system (which will
require some configuration to make it work seamlessly with Nix shells see
the \code{vignette("configuring-ide")} for configuration examples), use
"none". Please be aware that VS Code and Positron are not free software. To
facilitate their installation, \code{rix()} automatically enables a required
setting without prompting the user for confirmation. See the "Details"
section below for more information.}

\item{template}{Character, the flake template to use. One of:
\itemize{
\item \code{"minimal"}: Basic R environment (default)
\item \code{"docker"}: OCI container generation
\item Additional templates (radian, rstudio, vscode) are planned for
future releases.
}}

\item{project_path}{Character, where to write \code{default.nix}, for example
"/home/path/to/project". The file will thus be written to the file
"/home/path/to/project/default.nix". If the folder does not exist, it will
be created.}

\item{overwrite}{Logical, defaults to FALSE. If TRUE, overwrite the
\code{default.nix} file in the specified path.}

\item{git_tracking}{Logical, defaults to \code{TRUE}. If \code{TRUE}, warn if
the generated \code{.rixpackages.nix} is not tracked by git (required for flakes).}

\item{message_type}{Character. Message type, defaults to \code{"simple"}, which
gives minimal but sufficient feedback. Other values are currently
\verb{"quiet}, which generates the files without message, and \code{"verbose"}, displays all the messages.}

\item{shell_hook}{Character of length 1, defaults to \code{NULL}. Commands added
to the \code{shellHook} variable are executed when the Nix shell starts. So by
default, using \verb{nix-shell default.nix} will start a specific program,
possibly with flags (separated by space), and/or do shell actions. You can
for example use \code{shell_hook = R}, if you want to directly enter the
declared Nix R session when dropping into the Nix shell.}

\item{ignore_remotes_cache}{Logical, defaults to FALSE. This variable is only
needed when adding packages from GitHub with remote dependencies, it can be
ignored otherwise. If \code{TRUE}, the cache of already processed GitHub remotes
will be ignored and all packages will be processed. If \code{FALSE}, the cache
will be used to skip already processed packages, which makes use of fewer
API calls. Setting this argument to \code{TRUE} can be useful for debugging.}
}
\value{
Invisibly returns the path to the generated \code{flake.nix} file.
Side effects: Creates \code{flake.nix}, \code{.rixpackages.nix}, and optionally
\code{flake.lock} if Nix is available.
}
\description{
This function generates a Nix flake configuration for the project,
providing a modern interface to Nix with lock file support for exact
reproducibility. Flakes allow declarative specification of dependencies,
multiple development shells, and easy sharing of development environments.

This function is \strong{experimental} and complements the existing \code{rix()}
function. While \code{rix()} generates a \code{default.nix} file compatible with
traditional Nix workflows, \code{flake()} generates a \code{flake.nix} that
provides additional features like lock files, multiple shells, and
integration with the modern Nix ecosystem.
}
\examples{
\dontrun{
# Initialize a minimal flake
flake(
  r_ver = "4.3.1",
  r_pkgs = c("dplyr", "ggplot2"),
  project_path = "."
)

# Initialize a flake with Docker support
flake(
  r_ver = "4.3.1",
  r_pkgs = c("dplyr", "ggplot2", "plumber"),
  template = "docker",
  project_path = "."
)
}
}
\seealso{
Other core functions: 
\code{\link{rix}()},
\code{\link{rix_init}()}
}
\concept{core functions}
