---
title: "4a - Installing R packages in a Nix environment"
output: html_document
editor_options:
  chunk_output_type: console
  markdown: 
    wrap: 80
---

## Introduction

You now know how to declare and build reproducible development environments using `{rix}`
and Nix. This vignette will explain how to install specific versions of CRAN packages
and how to install packages from GitHub.

## Installing old packages archived on CRAN

It is possible to install an arbitrary version of a package that has been
archived on CRAN:

```{r}
path_default_nix <- tempdir()

rix(r_ver = "4.2.1",
    r_pkgs = c("dplyr@0.8.0", "janitor@1.0.0"),
    system_pkgs = NULL,
    git_pkgs = NULL,
    ide = "other",
    project_path = path_default_nix,
    overwrite = TRUE)
```

```{r, echo = F}
cat(readLines(paste0(path_default_nix, "/default.nix")), sep = "\n")
```

The above expression will install R version 4.2.1, and `{dplyr}` at version
0.8.0 and `{janitor}` at version 1.0.0. This can be useful, especially for
packages that have been archived, but otherwise, this feature should ideally be
used sparingly. If you want to reconstruct an environment as it was around 2019,
use the version of R that was current at that time. This will ensure that every
package that gets installed is at a version compatible with that version of R,
which might not be the case if you need to install a very old version of one
particular package.

## Installing packages from Github

It is also possible to install packages from Github:

```{r}
rix(r_ver = "4.2.1",
    r_pkgs = c("dplyr", "janitor"),
    git_pkgs = list(
                 list(package_name = "housing",
                   repo_url = "https://github.com/rap4all/housing/",
                   branch_name = "fusen",
                   commit = "1c860959310b80e67c41f7bbdc3e84cef00df18e"),
                 list(package_name = "fusen",
                   repo_url = "https://github.com/ThinkR-open/fusen",
                   branch_name = "main",
                   commit = "d617172447d2947efb20ad6a4463742b8a5d79dc")
    ),
    ide = "other",
    project_path = path_default_nix,
    overwrite = TRUE)

```

```{r, echo = F}
cat(readLines(paste0(path_default_nix, "/default.nix")), sep = "\n")
```

This will install two packages from Github: the `{housing}` package and more
specifically the code as it is in the `fusen` branch. The commit is also
provided, to pin the exact version of the package needed. The `{fusen}` package
is also installed, from the main branch at commit `d617172447d`.

## A complete example

This example shows how to install packages from CRAN, from the CRAN archives and
from GitHub:

```{r}
rix(r_ver = "4.2.1",
    r_pkgs = c("dplyr", "janitor", "AER@1.2-8"),
    git_pkgs = list(
                 list(package_name = "housing",
                   repo_url = "https://github.com/rap4all/housing/",
                   branch_name = "fusen",
                   commit = "1c860959310b80e67c41f7bbdc3e84cef00df18e"),
                 list(package_name = "fusen",
                   repo_url = "https://github.com/ThinkR-open/fusen",
                   branch_name = "main",
                   commit = "d617172447d2947efb20ad6a4463742b8a5d79dc")
    ),
    ide = "other",
    project_path = path_default_nix,
    overwrite = TRUE)

```

```{r, echo = F}
cat(readLines(paste0(path_default_nix, "/default.nix")), sep = "\n")
```

The next vignette,
`vignette("d2-installing-system-tools-and-texlive-packages-in-a-nix-environment")`,
explains how you can install tools such as text editors, git, Quarto, TexLive
packages, and any other tool available through `nixpkgs` for your development
environments.
